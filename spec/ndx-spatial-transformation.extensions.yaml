groups:
  # Base class for all spatial transformations
  - neurodata_type_def: SpatialTransformation
    neurodata_type_inc: NWBContainer
    doc: |
      Base class for spatial transformations used in image registration and coordinate mapping.
      Supports transformations between different coordinate spaces (e.g., image space to atlas space).

  # Rigid transformation (rotation + translation)
  - neurodata_type_def: RigidTransformation
    neurodata_type_inc: SpatialTransformation
    doc: |
      Rigid body transformation preserving distances and angles.
      For 2D: 3 DOF (1 rotation + 2 translations)
    datasets:
      - name: rotation_matrix
        dtype: float
        doc: "Rotation matrix. Shape: (2, 2) for 2D"
        shape:
          - 2
          - 2
        dims:
          - rows
          - columns

      - name: translation_vector
        dtype: float
        doc: "Translation vector."
        shape:
          - 2
        dims:
          - dimensions
      - name: center_of_rotation
        dtype: float
        doc: "Center point for rotation. Optional."
        shape:
          - 2
        dims:
          - dimensions
        quantity: "?" # optional dataset

  # Similarity transformation (rotation + translation + uniform scaling)
  - neurodata_type_def: SimilarityTransformation
    neurodata_type_inc: RigidTransformation
    doc: |
      Similarity transformation preserving angles but not distances.
      For 2D: 4 DOF (1 rotation + 2 translations + 1 scale)
    datasets:
      - name: scale
        dtype: float
        doc: "Uniform scaling factor (single value)."

  # Landmarks with associated transformation
  - neurodata_type_def: Landmarks
    neurodata_type_inc: DynamicTable
    doc: |
      Spatial landmarks annotated on an image with their coordinates in both
      source and target spaces, along with the associated spatial transformation.
    links:
      - target_type: SpatialTransformation
        quantity: "?"
        doc: "The spatial transformation mapping source to target coordinates."
        name: transformation

      - target_type: Image
        quantity: "?"
        doc: "The source image associated with the landmarks."
        name: source_image

      - target_type: Image
        quantity: "?"
        doc: "The target/registered image (optional)."
        name: target_image

    datasets:
      - name: source_coordinates
        neurodata_type_inc: VectorData
        dtype: float
        doc: |
          Coordinates of each landmark in the source space.
          Shape: (n_landmarks, dimensionality)
        dims:
          - landmarks
          - dimensions
        shape:
          - null
          - null

      - name: target_coordinates
        neurodata_type_inc: VectorData
        dtype: float
        doc: |
          Coordinates of each landmark in the target/registered space.
          Shape: (n_landmarks, dimensionality)
        dims:
          - landmarks
          - dimensions
        shape:
          - null
          - null
        quantity: "?" # optional dataset

      - name: landmark_labels
        neurodata_type_inc: VectorData
        dtype: text
        doc: "Optional labels or names for each landmark."
        quantity: "?" # optional dataset

      - name: confidence
        neurodata_type_inc: VectorData
        dtype: float
        doc: "Optional confidence scores for each landmark (0-1)."
        quantity: "?" # optional dataset

  # Container for storing multiple transformations
  - neurodata_type_def: SpatialTransformationMetadata
    neurodata_type_inc: LabMetaData
    doc: |
      Metadata container for storing spatial transformations and landmarks.
      Use this to organize multiple transformations associated with your experiment.
    groups:
      - neurodata_type_inc: SpatialTransformation
        doc: "Collection of spatial transformations."
        quantity: "*"

      - neurodata_type_inc: Landmarks
        doc: "Collection of landmark sets."
        quantity: "*"
